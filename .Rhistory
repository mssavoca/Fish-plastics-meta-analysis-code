# theme(axis.text.x = element_text(size=12),
#       axis.text.y = element_text(size=12),
#       axis.title=element_text(size=13, face="bold"),
#       strip.text = element_text(size = 12))
Fig_3 + guides(size = FALSE)
Fig_3 <- ggplot(filter(d_full, Found != "NA"),
aes(average_depth, prop_w_plastic, size = N, weight = N)) +
geom_point(alpha = 0.4) +
geom_smooth(col = "blue", method = "loess", se = TRUE) +
geom_hline(yintercept = 0, linetype = "dashed") +
#facet_wrap(~ Found, scales = "free_y", ncol = 1) +
coord_flip() +
scale_x_reverse() +
xlim(1500,0) +
xlab("Average depth") +
ylab("Proportion of individuals with ingested plastic") +
theme_classic(base_size = 16)
# theme(axis.text.x = element_text(size=12),
#       axis.text.y = element_text(size=12),
#       axis.title=element_text(size=13, face="bold"),
#       strip.text = element_text(size = 12))
Fig_3 + guides(size = FALSE)
# Figure 4, species accumulation curves----
## Cumulative unique entries in list of vectors
cum_unique <- function(l) {
result <- integer(length(l))
for (i in 1:length(l)) {
result[i] <- length(unique(unlist(l[1:i])))
}
result
}
d_rarefaction_all <-  d_full %>%
group_by(publication_year) %>%
summarize(species = list(unique(binomial)),
annual_N = sum(N)) %>%
ungroup %>%
mutate(cum_species = cum_unique(species),
cum_n = cumsum(annual_N),
cpue = cum_species / cum_n)
d_rarefaction_ingest_only <-  d_full %>%
filter(prop_w_plastic > 0) %>%
group_by(publication_year) %>%
summarize(species = list(unique(binomial)),
annual_N = sum(N)) %>%
ungroup %>%
mutate(cum_species = cum_unique(species),
cum_n = cumsum(annual_N),
cpue = cum_species / cum_n)
rarefaction_plot <- ggplot() +
geom_line(data = d_rarefaction_all, aes(cum_n, cum_species), color = "dark blue") +
geom_line(data = d_rarefaction_ingest_only, aes(cum_n, cum_species), color = "dark red") +
geom_point(data = d_rarefaction_all, aes(cum_n, cum_species)) +
geom_point(data = d_rarefaction_ingest_only, aes(cum_n, cum_species)) +
geom_text_repel(data = d_rarefaction_all,
aes(cum_n, cum_species, label = publication_year),
nudge_x = -1500, nudge_y = 10,
segment.color = "black") +
geom_text_repel(data = d_rarefaction_ingest_only,
aes(cum_n, cum_species, label = publication_year),
nudge_x = 1500, nudge_y = -10,
segment.color = "black") +
labs(x = "Cumulative number of individuals sampled",
y = "Cumuluative number of species sampled") +
theme_classic(base_size = 14)
rarefaction_plot
# Figure S1, number of studies over time----
study_hist <- d %>%
group_by(publication_year) %>%
summarize(n_studies = n_distinct(source)) %>%
ggplot(aes(publication_year, n_studies)) +
geom_bar(stat = "identity") +
geom_smooth(se = FALSE) +
theme_classic(base_size = 14) +
xlab("Publication year") +
ylab("Number of studies")
study_hist
d_full_wo_gaps <- d %>%
filter(includes_microplastic == "Y") %>%
drop_na(average_depth, Found, trophic_level_via_fishbase, prime_forage, NwP, N,
adjacency, mean_poll_abund)
# wrapper fucntion  needed to allow MuMIn to compare models
gamm4 <- function(...) structure(c(gamm4::gamm4(...), list(call = match.call())), class = c("gamm", "list"))
glmm_FwP_eco_geo <- glmer(cbind(NwP, N-NwP) ~ trophic_level_via_fishbase +
scale(average_depth) +
scale(mean_poll_abund) +
Found + prime_forage + adjacency +
(1|order) + (1|source),
na.action = "na.fail",
data = d_full_wo_gaps, family = binomial)
summary(glmm_FwP_eco_geo)
r.squaredGLMM(glmm_FwP_eco_geo)
d = read_csv("Plastics ingestion records fish master_final_2019data.csv") %>%
janitor::clean_names() %>%
rename(NwP = nw_p,
N = n) %>%
mutate(WeightedProp = prop_w_plastic * N,
Found = as_factor(case_when(habitat %in% c("demersal", "reef-associated", "benthopelagic", "bathydemersal") ~ "demersal",
habitat %in% c("pelagic-neritic", "pelagic-oceanic", "mesopelagic", "bathypelagic") ~ "pelagic")),
prime_forage = na_if(prime_forage, "not listed")) %>%
rename(ProvCode = "oceanographic_province_from_longhurst_2007") %>%
separate(binomial, into = c("genus", "species"), sep = " ", remove = FALSE) %>%
left_join(dplyr::select(d_poll, c(ProvCode, adjacency, mean_poll_abund)), by = "ProvCode") %>%
mutate(adjacency = as_factor(case_when(adjacency == 1 ~ "Land",
adjacency == 0 ~ "Oceanic")))
########################################################
# Figures for fish-plastic ingestion meta-analysis paper
########################################################
#load packages, data, and functions ----
library(tidyverse)
library(ggtree)
library(ggstance)
library(ape)
library(phylobase)
library(dismo)
library(readxl)
library(rotl) #for phylogenetic analyses, get all the species? from Hinchliff et al. 2015 PNAS
library(phytools)
library(tidyverse)
library(stringr)
library(mgcv)
library(gamm4)
library(MuMIn)
library(ggrepel)
library(sjPlot)
install.packages("tidyr")
install.packages("tibble")
library(tibble)
SE = function(x){sd(x)/sqrt(sum(!is.na(x)))}
# Abbreviate a binomial e.g. Balaenoptera musculus -> B. musculus
abbr_binom <- function(binom) {
paste(str_sub(binom, 1, 1),
str_extract(binom, " .*"),
sep = ".")
}
d_poll <- as_tibble(read_csv("Spatial Information_microplastics.csv"))
d = read_csv("Plastics ingestion records fish master_final_2019data.csv") %>%
janitor::clean_names() %>%
rename(NwP = nw_p,
N = n) %>%
mutate(WeightedProp = prop_w_plastic * N,
Found = as_factor(case_when(habitat %in% c("demersal", "reef-associated", "benthopelagic", "bathydemersal") ~ "demersal",
habitat %in% c("pelagic-neritic", "pelagic-oceanic", "mesopelagic", "bathypelagic") ~ "pelagic")),
prime_forage = na_if(prime_forage, "not listed")) %>%
rename(ProvCode = "oceanographic_province_from_longhurst_2007") %>%
separate(binomial, into = c("genus", "species"), sep = " ", remove = FALSE) %>%
left_join(dplyr::select(d_poll, c(ProvCode, adjacency, mean_poll_abund)), by = "ProvCode") %>%
mutate(adjacency = as_factor(case_when(adjacency == 1 ~ "Land",
adjacency == 0 ~ "Oceanic")))
d_full <- d %>%
filter(includes_microplastic == "Y")
install.packages("tidyr")
library(tibble)
SE = function(x){sd(x)/sqrt(sum(!is.na(x)))}
# Abbreviate a binomial e.g. Balaenoptera musculus -> B. musculus
abbr_binom <- function(binom) {
paste(str_sub(binom, 1, 1),
str_extract(binom, " .*"),
sep = ".")
}
d_poll <- as_tibble(read_csv("Spatial Information_microplastics.csv"))
library(tidyr)
library(tidyverse)
library(ggtree)
library(ggstance)
library(ape)
library(phylobase)
library(dismo)
library(readxl)
library(rotl) #for phylogenetic analyses, get all the species? from Hinchliff et al. 2015 PNAS
library(phytools)
library(tidyverse)
library(stringr)
library(mgcv)
library(gamm4)
library(MuMIn)
library(ggrepel)
library(sjPlot)
library(tibble)
library(tidyr)
SE = function(x){sd(x)/sqrt(sum(!is.na(x)))}
# Abbreviate a binomial e.g. Balaenoptera musculus -> B. musculus
abbr_binom <- function(binom) {
paste(str_sub(binom, 1, 1),
str_extract(binom, " .*"),
sep = ".")
}
d_poll <- as_tibble(read_csv("Spatial Information_microplastics.csv"))
d = read_csv("Plastics ingestion records fish master_final_2019data.csv") %>%
janitor::clean_names() %>%
rename(NwP = nw_p,
N = n) %>%
mutate(WeightedProp = prop_w_plastic * N,
Found = as_factor(case_when(habitat %in% c("demersal", "reef-associated", "benthopelagic", "bathydemersal") ~ "demersal",
habitat %in% c("pelagic-neritic", "pelagic-oceanic", "mesopelagic", "bathypelagic") ~ "pelagic")),
prime_forage = na_if(prime_forage, "not listed")) %>%
rename(ProvCode = "oceanographic_province_from_longhurst_2007") %>%
separate(binomial, into = c("genus", "species"), sep = " ", remove = FALSE) %>%
left_join(dplyr::select(d_poll, c(ProvCode, adjacency, mean_poll_abund)), by = "ProvCode") %>%
mutate(adjacency = as_factor(case_when(adjacency == 1 ~ "Land",
adjacency == 0 ~ "Oceanic")))
d_full <- d %>%
filter(includes_microplastic == "Y")
p <- ggplot(d_full,
aes(trophic_level_via_fishbase, y= prop_w_plastic,
size= N, weight = N)) +
geom_point(alpha = 0.4) +  # Eventually add in foraging behavior here
geom_smooth(col = "blue", method = "loess") +
#xlim(2, 5) +
xlab("Trophic level") +
ylab("Proportion of individuals with ingested plastic") +
annotate("text", x = c(2.75, 4), y= -0.05,
label = c("planktivorous", "piscivorous")) +
theme_classic() +
theme(axis.text.x = element_text(size=12),
axis.text.y = element_text(size=12),
axis.title=element_text(size=13, face="bold"))
p + guides(size = FALSE)
d_full_wo_gaps <- d %>%
filter(includes_microplastic == "Y") %>%
drop_na(average_depth, Found, trophic_level_via_fishbase, prime_forage, NwP, N,
adjacency, mean_poll_abund)
glmm_FwP_eco_geo <- glmer(cbind(NwP, N-NwP) ~ trophic_level_via_fishbase +
scale(average_depth) +
scale(mean_poll_abund) +
Found + prime_forage + adjacency +
(1|order) + (1|source),
na.action = "na.fail",
data = d_full_wo_gaps, family = binomial)
summary(glmm_FwP_eco_geo)
r.squaredGLMM(glmm_FwP_eco_geo)
# plot total model predictors on response varaible
plot_model(glmm_FwP_eco_geo) +
ggtitle("Response: Proportion with ingested plastic") +
xlab("Predictors") +
theme_bw() +
geom_hline(yintercept = 1) +
ylim(0.001,2)
# plot main effects WOW
plot_model(glmm_FwP_eco_geo, type = "eff")[[1]]
# plot random effects WOW
plot_model(glmm_FwP_eco_geo, type = "re")[[2]] +
fct_reorder(term, estimate) +
ggtitle("Response: Proportion with ingested plastic") +
xlab("Order") +
ylab("Random intercept") +
theme_bw() +
geom_hline(yintercept = 1)
# plot random effects WOW
plot_model(glmm_FwP_eco_geo, type = "re")[[2]] +
#fct_reorder(term, estimate) +
ggtitle("Response: Proportion with ingested plastic") +
xlab("Order") +
ylab("Random intercept") +
theme_bw() +
geom_hline(yintercept = 1)
glmm_FwP_eco <- glmer(cbind(NwP, N-NwP) ~ trophic_level_via_fishbase +
scale(average_depth) +
Found + prime_forage +
(1|order) + (1|source),
na.action = "na.fail",
data = d_full_wo_gaps, family = binomial)
summary(glmm_FwP_eco)
# multi-model selection using AICc
GLMM_dredge <- dredge(glmm_FwP_eco_geo)
View(GLMM_dredge)
glmm_FwP_eco_geo <- glmer(cbind(NwP, N-NwP) ~ trophic_level_via_fishbase +
scale(average_depth) +
scale(mean_poll_abund) +
Found + prime_forage + adjacency +
(1|source),
na.action = "na.fail",
data = d_full_wo_gaps, family = binomial)
summary(glmm_FwP_eco_geo)
glmm_FwP_eco_geo <- glmer(cbind(NwP, N-NwP) ~ trophic_level_via_fishbase +
scale(average_depth) +
scale(mean_poll_abund) +
Found + prime_forage + adjacency +
(1|order),
na.action = "na.fail",
data = d_full_wo_gaps, family = binomial)
summary(glmm_FwP_eco_geo)
View(GLMM_dredge)
glmm_FwP_eco <- glmer(cbind(NwP, N-NwP) ~ trophic_level_via_fishbase +
scale(average_depth) +
Found + prime_forage +
(1|order) + (1|source),
na.action = "na.fail",
data = d_full_wo_gaps, family = binomial)
summary(glmm_FwP_eco)
#subset(GLMM_dredge, delta < 4)
a=model.avg(GLMM_dredge)
summary(a) #The ‘subset’ (or ‘conditional’) average only averages over the models where the parameter appears. An alternative, the ‘full’ average assumes that a variable is included in every model
summary(a) #The ‘subset’ (or ‘conditional’) average only averages over the models where the parameter appears. An alternative, the ‘full’ average assumes that a variable is included in every model
glmm_FwP_eco_geo <- glmer(cbind(NwP, N-NwP) ~ trophic_level_via_fishbase +
scale(average_depth) +
scale(mean_poll_abund) +
Found + prime_forage + adjacency +
(1|order) + (1|source),
na.action = "na.fail",
data = d_full_wo_gaps, family = binomial)
summary(glmm_FwP_eco_geo)
glmm_FwP_eco_geo <- glmer(cbind(NwP, N-NwP) ~ trophic_level_via_fishbase +
scale(average_depth) +
scale(mean_poll_abund) +
Found + prime_forage + adjacency +
(1|order),
na.action = "na.fail",
data = d_full_wo_gaps, family = binomial)
summary(glmm_FwP_eco_geo)
glmm_FwP_eco_geo <- glmer(cbind(NwP, N-NwP) ~ trophic_level_via_fishbase +
scale(average_depth) +
scale(mean_poll_abund) +
Found + prime_forage + adjacency +
(1|source),
na.action = "na.fail",
data = d_full_wo_gaps, family = binomial)
summary(glmm_FwP_eco_geo)
# plot random effects WOW
plot_model(glmm_FwP_eco_geo, type = "re")[[1]] +
#fct_reorder(term, estimate) +
ggtitle("Response: Proportion with ingested plastic") +
xlab("Order") +
ylab("Random intercept") +
theme_bw() +
geom_hline(yintercept = 1)
2
# plot random effects WOW
plot_model(glmm_FwP_eco_geo, type = "re")[[2]] +
#fct_reorder(term, estimate) +
ggtitle("Response: Proportion with ingested plastic") +
xlab("Order") +
ylab("Random intercept") +
theme_bw() +
geom_hline(yintercept = 1)
# plot random effects WOW
plot_model(glmm_FwP_eco_geo, type = "re")[[2]] +
#fct_reorder(term, estimate) +
ggtitle("Response: Proportion with ingested plastic") +
xlab("Order") +
ylab("Random intercept") +
theme_bw() +
geom_hline(yintercept = 1)
########################################################
# Figures for fish-plastic ingestion meta-analysis paper
########################################################
#load packages, data, and functions ----
library(tidyverse)
library(ggtree)
library(ggstance)
library(ape)
library(phylobase)
library(dismo)
library(readxl)
library(rotl) #for phylogenetic analyses, get all the species? from Hinchliff et al. 2015 PNAS
library(phytools)
library(tidyverse)
library(stringr)
library(mgcv)
library(gamm4)
library(MuMIn)
library(ggrepel)
library(sjPlot)
library(tibble)
library(tidyr)
SE = function(x){sd(x)/sqrt(sum(!is.na(x)))}
# Abbreviate a binomial e.g. Balaenoptera musculus -> B. musculus
abbr_binom <- function(binom) {
paste(str_sub(binom, 1, 1),
str_extract(binom, " .*"),
sep = ".")
}
d_poll <- as_tibble(read_csv("Spatial Information_microplastics.csv"))
d = read_csv("Plastics ingestion records fish master_final.csv")
View(d)
d_poll <- as_tibble(read_csv("Spatial Information_microplastics.csv"))
d = read_csv("Plastics ingestion records fish master_final.csv")
View(d)
d = read_csv("Plastics ingestion records fish master_final.csv") %>%
janitor::clean_names() %>%
rename(NwP = nw_p,
N = n) %>%
mutate(WeightedProp = prop_w_plastic * N,
Found = as_factor(case_when(habitat %in% c("demersal", "reef-associated", "benthopelagic", "bathydemersal") ~ "demersal",
habitat %in% c("pelagic-neritic", "pelagic-oceanic", "mesopelagic", "bathypelagic") ~ "pelagic")),
prime_forage = na_if(prime_forage, "not listed")) %>%
rename(ProvCode = "oceanographic_province_from_longhurst_2007") %>%
separate(binomial, into = c("genus", "species"), sep = " ", remove = FALSE) %>%
left_join(dplyr::select(d_poll, c(ProvCode, adjacency, mean_poll_abund)), by = "ProvCode") %>%
mutate(adjacency = as_factor(case_when(adjacency == 1 ~ "Land",
adjacency == 0 ~ "Oceanic")))
d_full <- d %>%
filter(includes_microplastic == "Y")
# species summary tables
d_sp_sum <- d %>%
filter(!species %in% c("sp.", "spp.")) %>%
group_by(binomial, order, commercial) %>%
summarize(Sp_mean = mean(prop_w_plastic),
Sample_size = sum(N),
num_studies = n_distinct(source)) %>%
ungroup %>%
mutate(commercial = factor(commercial),
studies_cat = as.double(cut(num_studies,
c(0, 1, 3, 6),
c(1,2,3))),
commercial = fct_collapse(commercial,
Commercial = c("commercial", "highly commercial"),
Minor = c("minor commercial", "subsistence"),
None = "none")) %>%
#filter(commercial == "Commercial") %>%
arrange(-Sp_mean)
View(d_sp_sum)
d = read_csv("Plastics ingestion records fish master_final.csv") %>%
janitor::clean_names() %>%
rename(NwP = nw_p,
N = n) %>%
mutate(WeightedProp = prop_w_plastic * N,
Found = as_factor(case_when(habitat %in% c("demersal", "reef-associated", "benthopelagic", "bathydemersal") ~ "demersal",
habitat %in% c("pelagic-neritic", "pelagic-oceanic", "mesopelagic", "bathypelagic") ~ "pelagic")),
prime_forage = na_if(prime_forage, "not listed")) %>%
rename(ProvCode = "oceanographic_province_from_longhurst_2007") %>%
separate(binomial, into = c("genus", "species"), sep = " ", remove = FALSE) %>%
left_join(dplyr::select(d_poll, c(ProvCode, adjacency, mean_poll_abund)), by = "ProvCode") %>%
mutate(adjacency = as_factor(case_when(adjacency == 1 ~ "Land",
adjacency == 0 ~ "Oceanic")))
d_full <- d %>%
filter(includes_microplastic == "Y")
# species summary tables
d_sp_sum <- d %>%
filter(!species %in% c("sp.", "spp.")) %>%
group_by(binomial, order, commercial) %>%
summarize(Sp_mean = mean(prop_w_plastic),
Sample_size = sum(N),
num_studies = n_distinct(source)) %>%
ungroup %>%
mutate(commercial = factor(commercial),
studies_cat = as.double(cut(num_studies,
c(0, 1, 3, 6),
c(1,2,3))),
commercial = fct_collapse(commercial,
Commercial = c("commercial", "highly commercial"),
Minor = c("minor commercial", "subsistence"),
None = "none")) %>%
#filter(commercial == "Commercial") %>%
arrange(-Sp_mean)
View(d_sp_sum)
# species summary tables
d_sp_sum <- d %>%
filter(!species %in% c("sp.", "spp.")) %>%
group_by(binomial, order, commercial) %>%
summarize(Sp_mean = mean(prop_w_plastic),
Sample_size = sum(N),
num_studies = n_distinct(source)) %>%
ungroup %>%
mutate(commercial = factor(commercial),
studies_cat = as.double(cut(num_studies,
c(0, 1, 3, 10),
c(1,2,3))),
commercial = fct_collapse(commercial,
Commercial = c("commercial", "highly commercial"),
Minor = c("minor commercial", "subsistence"),
None = "none")) %>%
#filter(commercial == "Commercial") %>%
arrange(-Sp_mean)
View(d_sp_sum)
d = read_csv("Plastics ingestion records fish master_final.csv") %>%
janitor::clean_names() %>%
rename(NwP = nw_p,
N = n) %>%
mutate(WeightedProp = prop_w_plastic * N,
Found = as_factor(case_when(habitat %in% c("demersal", "reef-associated", "benthopelagic", "bathydemersal") ~ "demersal",
habitat %in% c("pelagic-neritic", "pelagic-oceanic", "mesopelagic", "bathypelagic") ~ "pelagic")),
prime_forage = na_if(prime_forage, "not listed")) %>%
rename(ProvCode = "oceanographic_province_from_longhurst_2007") %>%
separate(binomial, into = c("genus", "species"), sep = " ", remove = FALSE) %>%
left_join(dplyr::select(d_poll, c(ProvCode, adjacency, mean_poll_abund)), by = "ProvCode") %>%
mutate(adjacency = as_factor(case_when(adjacency == 1 ~ "Land",
adjacency == 0 ~ "Oceanic")))
d_full <- d %>%
filter(includes_microplastic == "Y")
# species summary tables
d_sp_sum <- d %>%
filter(!species %in% c("sp.", "spp.")) %>%
group_by(binomial, order, commercial) %>%
summarize(Sp_mean = mean(prop_w_plastic, na.rm = TRUE),
Sample_size = sum(N),
num_studies = n_distinct(source)) %>%
ungroup %>%
mutate(commercial = factor(commercial),
studies_cat = as.double(cut(num_studies,
c(0, 1, 3, 10),
c(1,2,3))),
commercial = fct_collapse(commercial,
Commercial = c("commercial", "highly commercial"),
Minor = c("minor commercial", "subsistence"),
None = "none")) %>%
#filter(commercial == "Commercial") %>%
arrange(-Sp_mean)
View(d_sp_sum)
d = read_csv("Plastics ingestion records fish master_final.csv") %>%
janitor::clean_names() %>%
rename(NwP = nw_p,
N = n) %>%
mutate(WeightedProp = prop_w_plastic * N,
Found = as_factor(case_when(habitat %in% c("demersal", "reef-associated", "benthopelagic", "bathydemersal") ~ "demersal",
habitat %in% c("pelagic-neritic", "pelagic-oceanic", "mesopelagic", "bathypelagic") ~ "pelagic")),
prime_forage = na_if(prime_forage, "not listed")) %>%
rename(ProvCode = "oceanographic_province_from_longhurst_2007") %>%
separate(binomial, into = c("genus", "species"), sep = " ", remove = FALSE) %>%
left_join(dplyr::select(d_poll, c(ProvCode, adjacency, mean_poll_abund)), by = "ProvCode") %>%
mutate(adjacency = as_factor(case_when(adjacency == 1 ~ "Land",
adjacency == 0 ~ "Oceanic")))
View(d)
